erDiagram
    RESTAURANTS {
        uuid restaurant_id PK
        string name
        text address
        string phone
        string email
        text description
        text image_url
        text operating_hours
        string timezone
        decimal tax_rate
        decimal service_charge
        string currency
        boolean is_active
        datetime created_at
        datetime updated_at
    }

    USERS {
        uuid user_id PK
        string name
        text profile_picture
        string phone
        boolean is_active
        datetime last_login
        datetime created_at
        datetime updated_at
    }

    USER_ROLES {
        uuid user_role_id PK
        uuid user_id FK
        uuid restaurant_id FK
        enum role "super_admin, manager, staff, customer"
        boolean is_active
        datetime assigned_at
        datetime expires_at
        uuid assigned_by FK
    }

    TABLES {
        uuid table_id PK
        uuid restaurant_id FK
        string table_number
        text qr_code_data
        text qr_code_url
        int capacity
        enum status "available, occupied, reserved, maintenance, out_of_service"
        jsonb location_coordinates
        boolean is_active
        datetime last_scanned
        datetime created_at
        datetime updated_at
    }

    MENU_CATEGORIES {
        uuid category_id PK
        uuid restaurant_id FK
        string name
        text description
        text image_url
        int sort_order
        boolean is_active
        datetime available_from
        datetime available_until
        datetime created_at
        datetime updated_at
    }

    MENU_ITEMS {
        uuid item_id PK
        string name
        text description
        decimal price
        text image_url
        boolean is_available
        boolean is_featured
        int preparation_time
        text ingredients
        text allergens
        jsonb customization_options
        datetime created_at
        datetime updated_at
    }

    MENU_ITEM_CATEGORIES {
        uuid menu_item_id PK, FK
        uuid category_id PK, FK
    }

    ORDERS {
        uuid order_id PK
        uuid customer_id FK
        uuid table_id FK
        uuid restaurant_id FK
        string order_number
        enum status "pending, accepted, preparing, ready, served, cancelled"
        decimal subtotal
        decimal tax_amount
        decimal service_charge
        decimal total_amount
        decimal calculated_total
        text special_instructions
        datetime order_time
        datetime accepted_at
        datetime ready_at
        datetime served_at
        datetime cancelled_at
        datetime kitchen_cutoff_time
        int estimated_prep_time
        int actual_prep_time
        int max_prep_time
        datetime cancellation_deadline
        uuid processed_by FK
        boolean is_total_validated
        datetime created_at
        datetime updated_at
    }

    ORDER_ITEMS {
        uuid order_item_id PK
        uuid order_id FK
        uuid item_id FK
        int quantity
        decimal unit_price
        decimal total_price
        jsonb customizations
        enum status "pending, preparing, ready, served"
        datetime created_at
        datetime updated_at
    }

    NOTIFICATIONS {
        uuid notification_id PK
        uuid user_id FK
        uuid order_id FK
        string title
        text message
        enum type "order_placed, order_accepted, order_preparing, order_ready, order_served, order_cancelled, system_alert"
        enum priority "low, normal, high, urgent"
        boolean is_read
        jsonb metadata
        datetime sent_at
        datetime read_at
        datetime expires_at
        datetime created_at
    }

    QR_SCANS {
        uuid scan_id PK
        uuid table_id FK
        uuid customer_id FK
        string session_id
        enum session_status "active, expired, completed"
        inet ip_address
        text user_agent
        jsonb device_info
        text referrer_url
        datetime scanned_at
        datetime expires_at
        boolean led_to_order
        boolean is_active_session
        uuid order_id FK
    }

    ORDER_STATUS_HISTORY {
        uuid history_id PK
        uuid order_id FK
        uuid updated_by FK
        enum old_status "pending, accepted, preparing, ready, served, cancelled"
        enum new_status "pending, accepted, preparing, ready, served, cancelled"
        boolean is_valid_progression
        text notes
        text validation_errors
        int estimated_time
        datetime updated_at
    }

    ORDER_PAYMENTS {
        uuid payment_id PK
        uuid order_id FK
        enum payment_method "cash, card, digital_wallet, other"
        enum payment_status "pending, completed, failed, refunded"
        decimal amount_paid
        decimal change_given
        text payment_reference
        uuid processed_by FK
        datetime payment_time
        datetime created_at
        datetime updated_at
    }

    DIET_TYPE {
        uuid diet_type_id PK
        string name
    }

    MENU_ITEM_DIET_TYPES {
        uuid menu_item_id PK, FK
        uuid diet_type_id PK, FK
    }

    PROMOTIONS {
        uuid promotion_id PK
        uuid restaurant_id FK
        string name
        text description
        string type
        decimal value
        datetime start_date
        datetime end_date
        string voucher_code
        boolean is_active
    }

    APPLIED_PROMOTIONS {
        uuid applied_promotion_id PK
        uuid order_id FK
        uuid promotion_id FK
        decimal discount_amount
    }

    PROMOTION_CATEGORIES {
        uuid promotion_id PK, FK
        uuid category_id PK, FK
    }

    CARTS {
        uuid id PK
        uuid user_id FK
        text session_id
        uuid restaurant_id FK
        datetime created_at
        datetime updated_at
    }

    CART_ITEMS {
        uuid id PK
        uuid cart_id FK
        uuid menu_item_id FK
        int quantity
        numeric price_at_time_of_addition
        datetime created_at
        datetime updated_at
    }

    RESTAURANTS ||--o{ USER_ROLES : "employs"
    RESTAURANTS ||--o{ TABLES : "has"
    RESTAURANTS ||--o{ MENU_CATEGORIES : "contains"
    RESTAURANTS ||--o{ ORDERS : "receives"
    RESTAURANTS ||--o{ PROMOTIONS : "offers"
    RESTAURANTS ||--o{ CARTS : "has"
    USERS ||--o{ USER_ROLES : "assigned"
    USERS ||--o{ ORDERS : "places"
    USERS ||--o{ NOTIFICATIONS : "receives"
    USERS ||--o{ ORDER_STATUS_HISTORY : "updates"
    USERS ||--o{ QR_SCANS : "scans"
    USERS ||--o{ ORDER_PAYMENTS : "processes"
    USERS ||--o{ CARTS : "has"
    USER_ROLES }o--|| RESTAURANTS : "belongs_to"
    USER_ROLES }o--|| USERS : "assigned_to"
    USER_ROLES }o--o| USERS : "assigned_by"
    TABLES }o--|| RESTAURANTS : "located_in"
    TABLES ||--o{ ORDERS : "serves"
    TABLES ||--o{ QR_SCANS : "generates"
    MENU_CATEGORIES }o--|| RESTAURANTS : "belongs_to"
    MENU_CATEGORIES ||--|{ MENU_ITEM_CATEGORIES : "groups"
    MENU_CATEGORIES ||--|{ PROMOTION_CATEGORIES : "targeted by"
    MENU_ITEMS ||--|{ MENU_ITEM_CATEGORIES : "belongs to"
    MENU_ITEMS ||--|{ CART_ITEMS : "added to"
    ORDERS }o--|| USERS : "placed_by"
    ORDERS }o--|| TABLES : "served_at"
    ORDERS }o--|| RESTAURANTS : "belongs_to"
    ORDERS }o--o| USERS : "processed_by"
    ORDERS ||--o{ ORDER_ITEMS : "contains"
    ORDERS ||--o{ NOTIFICATIONS : "triggers"
    ORDERS ||--o{ ORDER_STATUS_HISTORY : "tracks"
    ORDERS ||--o{ ORDER_PAYMENTS : "paid_by"
    ORDERS ||--o{ QR_SCANS : "resulted_from"
    ORDERS ||--o{ APPLIED_PROMOTIONS : "has"
    ORDER_ITEMS }o--|| ORDERS : "belongs_to"
    ORDER_ITEMS }o--|| MENU_ITEMS : "references"
    NOTIFICATIONS }o--|| USERS : "sent_to"
    NOTIFICATIONS }o--o| ORDERS : "related_to"
    QR_SCANS }o--|| TABLES : "scanned_from"
    QR_SCANS }o--o| USERS : "scanned_by"
    QR_SCANS }o--o| ORDERS : "led_to"
    ORDER_STATUS_HISTORY }o--|| ORDERS : "tracks"
    ORDER_STATUS_HISTORY }o--|| USERS : "updated_by"
    ORDER_PAYMENTS }o--|| ORDERS : "pays_for"
    ORDER_PAYMENTS }o--|| USERS : "processed_by"
    MENU_ITEMS ||--|{ MENU_ITEM_DIET_TYPES : "has"
    DIET_TYPE ||--|{ MENU_ITEM_DIET_TYPES : "applies to"
    PROMOTIONS ||--|{ APPLIED_PROMOTIONS : "used in"
    PROMOTIONS ||--|{ PROMOTION_CATEGORIES : "targets"
    CARTS ||--o{ CART_ITEMS : "contains"
    CARTS }o--|| USERS : "owned_by"
    CARTS }o--|| RESTAURANTS : "for"
    CART_ITEMS }o--|| CARTS : "belongs_to"
    CART_ITEMS }o--|| MENU_ITEMS : "references"